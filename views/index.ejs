<%- include ('partials/_head') -%>
<body>
    <div class="hero">
        <div class="hero-subtitle">
            <h2>QBR Generator</h2>
            <button class="hero-button"><a href="#closed-won-deal-input">Get Started</a></button>
        </div>
    </div>

    <div class="grid">
    
    <div class="content">

    <div class="deal-information-container grid" id="closed-won-deal-input">
    <form method="post" action="/" class="_form_fields">
        <h1>Submit a Closed-Won deal here:</h1>
        <%- include ('partials/_form_fields') -%>
        <button type="submit" class="submit">Submit</button>
    </form>
    
    <form method="post" action="/lost" class="_form_fields">
        <h1>Submit a Closed-Lost deal here:</h1>
        <%- include ('partials/_form_fields_lost') -%>
        <button type="submit" class="submit">Submit</button>
    </form>
    </div> 

    <div class="deal-information-container grid">
    <div class="won-deals">
    <h1>Your <%= closedDeals.length %> Won Deal(s) This Quarter:</h1>
           <% closedDeals.forEach(ClosedDeal => { %>
        <div class="closed-deals" id="closed-deals">
            <div class="closed-deal-name"><p><a href="/<%= ClosedDeal.id %>"><%= ClosedDeal.companyName %>, <%= ClosedDeal.termLength %> Year Deal at $<%= ClosedDeal.ACV %> ACV.</a></p> 
            </div>
        </div> 
    <% }) %>
    </div>

    <div class="lost-deals">
    <h1>Your <%= lostDeals.length %> Lost Deal(s) This Quarter:</h1>
           <% lostDeals.forEach(LostDeal => { %>
        <div class="closed-lost-deals" id="closed-lost-deals">
            <div class="lost-deal-name"><p><a href="/lost/<%= LostDeal.id %>"><%= LostDeal.companyName %>, at $<%= LostDeal.ACV %> ACV.</a></p>
            </div> 
        </div>
    <% }) %>
    </div>

    <div class="metrics">
        <h1>Baseline Metrics:</h1>
        <h3>Close Rate by deal: <%= closeRateByDeal %></h3>
        <h3>Close Rate by ACV: <%= closeRateByACV %></h3>
        <h3>Customer/New split by deal: <%= customerNewSplitByDeal %></h3>
        <h3>Average sales cycle length, including initial prospective conversations: <%= averageSalesCycleLength %> days.</h3>
    </div>
    </div>
    
    <div class="chartOne">
        <canvas id="chartOne"></canvas>
        <script>
        var ctx = document.getElementById('chartOne').getContext('2d');
        var myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: <%- JSON.stringify(closedDealNames) %>,
                datasets: [{
                    label: 'ACV on Closed-Won Deals by Quarter',
                    data: [<%- closedDealACVArray %>],
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)'
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: true
                        }
                    }]
                }
            }
        });
        </script>

    </div>
        
    
    </div>

</body>
</html>